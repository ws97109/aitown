# 生成式AI代理問卷調查系統 - 完整使用指南

## 🎯 系統簡介

這是一個創新的AI問卷調查系統，結合了**生成式AI代理模擬**和**智能問卷填寫**功能。系統包含9個具有不同性格特徵的AI虛擬居民，能夠根據各自的性格和背景智能填寫問卷，為研究者提供多樣化且真實的調查數據。

### 主要特色
- 🤖 **9個獨特AI居民**：不同年齡、職業、性格的虛擬受訪者
- 📝 **智能問卷填寫**：基於性格特徵的真實回應生成
- 📊 **多種問卷類型**：單選、多選、評分、文字題全支援
- 🌐 **多種匯入方式**：Google表單、JSON格式、手動創建
- 📈 **完整數據分析**：即時統計、圖表可視化
- 💾 **多格式匯出**：CSV、JSON、Excel三種格式

---

## 🚀 快速開始

### 步驟一：環境準備

#### 1. 下載系統
```bash
# 克隆或下載專案到本地
git clone [你的專案網址]
cd generative_agents0910
```

#### 2. 安裝Python依賴
```bash
# 安裝必要套件
pip install flask requests python-dotenv

# 安裝Excel匯出功能 (可選)
pip install openpyxl
```

#### 3. 啟動 Ollama 服務 (本地AI模型)
```bash
# 安裝 Ollama (如果尚未安裝)
# 請到 https://ollama.com 下載安裝

# 下載所需模型
ollama pull qwen2.5:14b      # 主要對話模型
ollama pull bge-m3:latest    # 嵌入模型

# 啟動 Ollama 服務 (通常會自動啟動)
ollama serve
```

### 步驟二：啟動系統
```bash
# 啟動Web服務
python replay.py

# 系統啟動後，瀏覽器訪問：
# http://localhost:5001
```

---

## 📋 完整使用教學

### 🏠 首頁介紹

啟動系統後，你會看到主要的導航界面：

1. **角色互動力導向圖** - 查看AI居民的社交關係
2. **AI物品交互分析** - 分析居民與環境的互動
3. **📊 問卷調查系統** - ⭐ 我們的核心功能

點擊「📊 問卷調查系統」進入問卷管理界面。

---

### 📝 問卷管理系統

#### 1. 問卷列表頁面 (`/surveys`)

**功能說明：**
- 查看所有已創建的問卷
- 顯示問卷基本信息（標題、問題數量、創建時間）
- 提供快速操作按鈕

**可執行操作：**
- 🆕 **創建新問卷** - 點擊右上角「創建新問卷」按鈕
- 👁️ **查看問卷** - 點擊「查看」查看詳細內容和統計
- 🤖 **AI填寫** - 讓9個AI居民自動填寫問卷
- 📥 **匯出數據** - 下載CSV/JSON/Excel格式的結果

#### 2. 創建問卷頁面 (`/surveys/create`)

提供三種創建方式：

##### 方式一：手動創建 ⭐ 推薦新手使用
1. 填寫問卷標題和描述
2. 點擊「新增問題」添加題目
3. 選擇問題類型：
   - **單選題**：受訪者只能選一個答案
   - **多選題**：受訪者可選多個答案
   - **評分題**：1-5分評分
   - **文字題**：開放式文字回答
4. 設定選項（單選/多選題需要）
5. 點擊「創建問卷」完成

**💡 小技巧：** 點擊「使用示例問卷」可快速創建一個範例問卷

##### 方式二：Google表單匯入
1. 切換到「URL匯入」標籤
2. 貼上Google表單網址
3. 點擊「匯入問卷」
4. 系統會自動解析表單結構

**支援的網址格式：**
```
https://docs.google.com/forms/d/你的表單ID/viewform
https://forms.gle/短網址ID
```

##### 方式三：JSON格式匯入
1. 切換到「JSON匯入」標籤
2. 點擊「查看JSON格式範例」了解格式
3. 貼上JSON格式的問卷數據
4. 點擊「驗證JSON」確認格式正確
5. 點擊「匯入問卷」完成

**JSON範例：**
```json
{
  "title": "員工滿意度調查",
  "description": "2024年度員工滿意度調查問卷",
  "questions": [
    {
      "type": "single_choice",
      "text": "您對公司整體滿意度如何？",
      "options": ["非常滿意", "滿意", "普通", "不滿意", "非常不滿意"],
      "required": true
    },
    {
      "type": "text",
      "text": "請提供改善建議",
      "required": false
    }
  ]
}
```

---

### 🤖 AI居民填寫系統

#### AI居民介紹

系統內建9個具有獨特性格的AI居民：

| 居民姓名 | 年齡 | 身份 | 性格特點 | 填寫風格 |
|---------|------|------|----------|----------|
| 盧品蓉 | 20歲 | 大學生 | 友善熱心 | 積極正面回應 |
| 鄭傑丞 | 21歲 | 理工生 | 理性嚴謹 | 客觀中性分析 |
| 莊于萱 | 19歲 | 藝術生 | 創意自由 | 感性豐富表達 |
| 施宇鴻 | 22歲 | 研究生 | 邏輯思維 | 深度思考回應 |
| 游庭瑄 | 45歲 | 教授 | 博學睿智 | 教育者觀點 |
| 李昇峰 | 50歲 | 藥師 | 專業服務 | 實務經驗分享 |
| 魏祺紘 | 18歲 | 新生 | 活潑好奇 | 年輕化表達 |
| 陳冠佑 | 35歲 | 酒吧老闆 | 善於交際 | 社交化回應 |
| 蔡宗陞 | 28歲 | 咖啡師 | 追求品質 | 細膩用心回答 |

#### 如何讓AI填寫問卷

1. **進入問卷詳情頁面**
   - 在問卷列表中點擊「查看」
   - 或直接訪問 `/surveys/[問卷ID]`

2. **啟動AI填寫**
   - 點擊「讓AI居民填寫」按鈕
   - 系統會顯示進度對話框

3. **填寫過程**
   - 系統會依序讓9個AI居民填寫
   - 每個居民根據性格特徵生成回應
   - 整個過程約需要10-30秒

4. **查看結果**
   - 填寫完成後自動刷新頁面
   - 可立即看到統計結果和圖表

#### AI回應特色

**智能性格化回應：**
- 根據年齡選擇年齡層選項
- 基於性格特徵選擇滿意度答案
- 依據興趣愛好選擇多選項目
- 按照個性生成文字回應內容

**一致性保證：**
- 同一居民多次填寫會保持風格一致
- 回應邏輯符合角色設定
- 避免自相矛盾的答案組合

---

### 📊 數據分析與統計

#### 問卷詳情頁面功能

1. **基本統計資訊**
   - 總回應數量
   - 完成回應數量
   - 完成率百分比
   - 問題總數

2. **問卷結構展示**
   - 顯示所有問題內容
   - 標示問題類型和是否必填
   - 展示選擇題選項

3. **回應統計分析**
   - **選擇題**：顯示每個選項的選擇次數和百分比
   - **評分題**：計算平均分數，顯示星級評分
   - **文字題**：統計回應數量，展示部分內容預覽

4. **視覺化圖表**
   - 選擇題結果條形圖
   - 完成率進度條
   - 評分分佈統計

---

### 💾 數據匯出功能

#### 支援的匯出格式

##### 1. CSV格式 📄
- **適用場景**：Excel分析、統計軟體處理
- **檔案特色**：
  - 包含完整的回應數據
  - 多選題會展開成多個欄位
  - 中文編碼相容性佳

##### 2. JSON格式 💻
- **適用場景**：程式開發、API整合
- **檔案特色**：
  - 結構化數據格式
  - 包含問卷metadata
  - 易於程式解析

##### 3. Excel格式 📊
- **適用場景**：商業報告、深度分析
- **檔案特色**：
  - 包含統計摘要工作表
  - 自動調整欄位寬度
  - 專業格式化顯示

#### 如何匯出數據

**方式一：從問卷詳情頁面**
1. 進入問卷詳情頁面
2. 點擊右上角「匯出數據」下拉按鈕
3. 選擇想要的格式
4. 系統自動下載檔案

**方式二：從問卷列表頁面**
1. 在問卷列表中找到目標問卷
2. 點擊「匯出」下拉按鈕
3. 選擇格式直接下載

**匯出檔案命名規則：**
```
survey_[問卷ID]_[匯出時間].csv
例如：survey_abc123_20240912_143022.csv
```

---

## 🎯 實際使用場景

### 場景一：市場調研 🛒

**使用步驟：**
1. 創建產品滿意度調查問卷
2. 包含品牌偏好、價格接受度、使用習慣等題目
3. 讓AI居民填寫獲得多元觀點
4. 匯出數據進行市場分析

**價值：** 快速獲得不同年齡層、職業背景的消費者反饋

### 場景二：教育研究 📚

**使用步驟：**
1. 設計課程評估或學習偏好問卷
2. 涵蓋學習方式、教材評價、改進建議
3. AI居民根據教育背景給出回應
4. 分析結果優化教學設計

**價值：** 模擬多樣化學生群體的真實反饋

### 場景三：產品測試 💡

**使用步驟：**
1. 創建用戶體驗調查問卷
2. 評估產品功能、界面設計、使用感受
3. 收集AI居民的使用反饋
4. 識別產品改進機會

**價值：** 獲得多角度的產品評價和建議

### 場景四：社會調查 🏛️

**使用步驟：**
1. 設計社會議題或政策意見調查
2. 包含態度、行為、價值觀等面向
3. 分析不同背景居民的觀點差異
4. 了解社會多元聲音

**價值：** 探索複雜社會議題的多元觀點

---

## 🔧 系統設定與自定義

### 基本設定檔案

#### 1. 環境變數設定 (.env)
```bash
# Ollama 本地服務設定 (無需API密鑰)
OLLAMA_BASE_URL=http://127.0.0.1:11434
OLLAMA_MODEL=qwen2.5:14b
OLLAMA_EMBEDDING_MODEL=bge-m3:latest

# 系統設定
DEBUG=True
SECRET_KEY=你的密鑰

# 檔案路徑
SURVEY_DATA_PATH=survey_system/data
```

#### 2. 系統配置 (data/config.json)
```json
{
  "agent": {
    "think": {
      "llm": {
        "base_url": "http://127.0.0.1:11434/v1",
        "model": "qwen2.5:14b",
    "temperature": 0.7
  }
}
```

### 自定義AI居民

如果想要修改AI居民的特性，可以編輯 `survey_system/ai_filler.py` 檔案：

```python
# 找到 residents_info 字典，可以修改現有居民或添加新居民
"新居民姓名": {
    "age": 年齡,
    "personality": ["性格特徵1", "性格特徵2"],
    "interests": ["興趣1", "興趣2"],
    "lifestyle": "生活方式描述",
    "current_activity": "當前主要活動"
}
```

---

## ❓ 常見問題解答

### Q1: 系統需要網路連線嗎？
**A:** 基本功能不需要網路，但如果要使用Google表單匯入功能或AI生成更智能的回應，需要網路連線。

### Q2: AI居民的回應有多真實？
**A:** AI居民基於詳細的性格設定和一致性邏輯，會產生符合角色特徵的合理回應。雖然是模擬的，但具有很高的參考價值。

### Q3: 可以同時讓多個人使用系統嗎？
**A:** 目前版本主要設計為單用戶使用，但可以同時開啟多個瀏覽器分頁操作不同問卷。

### Q4: 匯出的數據可以用Excel開啟嗎？
**A:** 可以！CSV和Excel格式都可以直接用Excel開啟，中文顯示正常。

### Q5: 系統支持多語言嗎？
**A:** 目前主要支援繁體中文，介面和AI回應都是中文。未來版本會考慮多語言支援。

### Q6: 如何備份我的問卷數據？
**A:** 所有數據存儲在 `survey_system/data/` 資料夾中，定期備份此資料夾即可。

### Q7: 問卷數量有限制嗎？
**A:** 沒有硬性限制，但建議單一問卷不超過50個問題，以確保最佳性能。

### Q8: AI填寫需要多長時間？
**A:** 通常10-30秒內完成，取決於問題數量和網路狀況。

---

## 🆘 故障排除

### 常見錯誤及解決方法

#### 1. 無法啟動系統
```bash
# 錯誤：ModuleNotFoundError
解決：pip install flask requests python-dotenv

# 錯誤：Port 5001 already in use
解決：更改replay.py最後一行的port參數，或關閉佔用的程式
```

#### 2. AI填寫功能異常
```bash
# 檢查API設定
確認.env檔案中的API_KEY設定正確

# 檢查網路連線
確保能夠訪問外部API服務
```

#### 3. 匯出功能問題
```bash
# Excel匯出失敗
解決：pip install openpyxl

# 中文亂碼問題
使用UTF-8編碼開啟CSV檔案
```

#### 4. 頁面無法載入
```bash
# 清除瀏覽器快取
# 確認Flask服務正在運行
# 檢查console是否有JavaScript錯誤
```

---

## 📞 技術支援

### 獲得幫助的方式

1. **查看系統日誌**
   - 在終端查看詳細錯誤信息
   - 檢查 `logs/` 資料夾中的日誌檔案

2. **測試系統功能**
   ```bash
   # 運行測試套件
   python survey_system/test_survey.py
   ```

3. **重置系統**
   ```bash
   # 刪除所有數據重新開始
   rm -rf survey_system/data/
   # 系統會自動重新創建資料夾
   ```

4. **更新系統**
   ```bash
   # 拉取最新版本
   git pull origin main
   
   # 更新依賴
   pip install -r requirements.txt
   ```

---

## 🎉 開始使用

現在你已經掌握了系統的完整使用方法！

### 建議的首次使用流程：

1. **🚀 啟動系統** - `python replay.py`
2. **📝 創建第一個問卷** - 使用「示例問卷」功能
3. **🤖 讓AI填寫** - 體驗智能填寫功能
4. **📊 查看統計** - 分析結果數據
5. **💾 匯出數據** - 下載Excel報告

### 💡 使用小技巧：

- 先從簡單的問卷開始熟悉系統
- 觀察不同AI居民的回答風格差異
- 嘗試不同類型的問題組合
- 定期匯出數據備份重要調查

**🌟 開始探索這個強大的AI問卷調查系統吧！**

---

*最後更新：2024年9月12日*
*如有任何問題，請查看上方的故障排除章節或聯繫技術支援*